<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VAIRAL VIDEO - Anti Reload Timer</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root { --main-grad: linear-gradient(135deg, #8e2de2, #4a00e0); --bg: #f4f7f6; }
        body { background: var(--bg); color: #333; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; }
        .header-section { background: var(--main-grad); padding: 35px 20px 50px; text-align: center; color: white; border-radius: 0 0 40px 40px; }
        .search-container { padding: 0 20px; margin-top: -25px; }
        .search-box { width: 100%; padding: 15px; border-radius: 15px; border: none; box-shadow: 0 10px 25px rgba(0,0,0,0.1); font-size: 16px; outline: none; box-sizing: border-box; }
        .main-content { padding: 20px 15px; }
        .card { background: white; border-radius: 22px; overflow: hidden; margin-bottom: 25px; box-shadow: 0 8px 20px rgba(0,0,0,0.06); }
        .thumb-box { width: 100%; height: 200px; }
        .thumb-box img { width: 100%; height: 100%; object-fit: cover; }
        .card-details { padding: 18px; text-align: center; }
        .unlock-btn { background: var(--main-grad); color: white; border: none; padding: 14px; width: 100%; border-radius: 14px; font-weight: bold; cursor: pointer; font-size: 15px; }
        .unlock-btn:disabled { background: #95a5a6; cursor: not-allowed; }
        .download-btn { background: #2ecc71 !important; }
        
        /* ‡¶´‡ßç‡¶≤‡ßã‡¶ü‡¶ø‡¶Ç ‡¶ü‡¶æ‡¶á‡¶Æ‡¶æ‡¶∞ */
        #timer-overlay {
            display: none; position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9); color: white; padding: 15px 25px; border-radius: 50px;
            z-index: 10000; font-weight: bold; text-align: center; width: 85%; max-width: 320px;
        }
        .progress-bar { width: 100%; height: 6px; background: #444; margin-top: 10px; border-radius: 10px; overflow: hidden; }
        #bar-fill { width: 0%; height: 100%; background: #2ecc71; transition: 0.3s; }
    </style>
</head>
<body>

    <div id="timer-overlay">
        <span id="timer-msg">‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®: <span id="time-left">10</span> ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°</span>
        <div class="progress-bar"><div id="bar-fill"></div></div>
    </div>

    <div class="header-section">
        <h1>All Video PLAY üîû</h1>
        <p>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßá ‡ßß‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
    </div>

    <div class="search-container">
        <input type="text" id="videoSearch" class="search-box" placeholder="‡¶≠‡¶ø‡¶°‡¶ø‡¶ì‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡ßü‡ßá ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶ï‡¶∞‡ßÅ‡¶®..." onkeyup="renderUI()">
    </div>

    <div class="main-content" id="video-display">‡¶≤‡ßã‡¶°‡¶ø‡¶Ç...</div>

    <script>
        const firebaseConfig = { databaseURL: "https://myvideobot-9f9ee-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let allVideos = {};
        let timerInterval = null;

        function getCurrentStep(v_id) {
            const expiry = localStorage.getItem('expiry_' + v_id);
            if (expiry && Date.now() > parseInt(expiry)) {
                localStorage.removeItem('step_' + v_id);
                localStorage.removeItem('expiry_' + v_id);
                return 0;
            }
            return parseInt(localStorage.getItem('step_' + v_id)) || 0;
        }

        db.ref('videos').on('value', (snap) => {
            allVideos = snap.val();
            renderUI();
            checkExistingTimer(); // ‡¶™‡ßá‡¶ú ‡¶≤‡ßã‡¶° ‡¶¨‡¶æ ‡¶∞‡¶ø‡¶≤‡ßã‡¶° ‡¶π‡¶≤‡ßá ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶¨‡ßá ‡¶ü‡¶æ‡¶á‡¶Æ‡¶æ‡¶∞ ‡¶ö‡¶≤‡¶õ‡ßá ‡¶ï‡¶ø ‡¶®‡¶æ
        });

        function renderUI() {
            const container = document.getElementById('video-display');
            const searchInput = document.getElementById('videoSearch').value.toLowerCase();
            container.innerHTML = "";
            for (let id in allVideos) {
                if (!allVideos[id].name.toLowerCase().includes(searchInput)) continue;
                const ads = allVideos[id].ads || [];
                const step = getCurrentStep(id);
                const total = ads.length;
                let btnTxt = step >= total ? "üì• GET VIDEO (DOWNLOAD)" : (step > 0 ? "üîì UNLOCK NEXT AD" : "üîí UNLOCK VIDEO");
                let btnClass = step >= total ? "unlock-btn download-btn" : "unlock-btn";
                container.innerHTML += `
                    <div class="card">
                        <div class="thumb-box"><img src="${allVideos[id].photo}"></div>
                        <div class="card-details">
                            <h3>${allVideos[id].name}</h3>
                            <button id="btn-${id}" class="${btnClass}" onclick='handleAdClick("${id}", ${JSON.stringify(ads)})'>${btnTxt}</button>
                            <span class="ad-counter">${step >= total ? '‚úÖ ‡¶Ü‡¶®‡¶≤‡¶ï ‡¶∏‡¶´‡¶≤' : '‡¶ß‡¶æ‡¶™: ' + step + '/' + total}</span>
                        </div>
                    </div>`;
            }
        }

        function handleAdClick(v_id, ads) {
            let step = getCurrentStep(v_id);
            if (step >= ads.length) {
                localStorage.setItem('expiry_' + v_id, Date.now() + (24 * 60 * 60 * 1000));
                window.location.href = "https://t.me/vairal_video18_bot?start=" + v_id;
                return;
            }

            if (localStorage.getItem('timer_running')) return;

            // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶ì‡¶™‡ßá‡¶® ‡¶ï‡¶∞‡¶æ
            window.open(ads[step], '_blank');

            // ‡¶ü‡¶æ‡¶á‡¶Æ‡¶æ‡¶∞ ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞‡ßç‡¶ü ‡¶è‡¶¨‡¶Ç ‡¶Æ‡ßá‡¶Æ‡ßã‡¶∞‡¶ø‡¶§‡ßá ‡¶∏‡ßá‡¶≠
            const endTime = Date.now() + 10000;
            localStorage.setItem('timer_end', endTime);
            localStorage.setItem('timer_v_id', v_id);
            localStorage.setItem('timer_running', 'true');
            
            runTimerLogic();
        }

        function checkExistingTimer() {
            if (localStorage.getItem('timer_running') === 'true') {
                runTimerLogic();
            }
        }

        function runTimerLogic() {
            const overlay = document.getElementById('timer-overlay');
            const timeSpan = document.getElementById('time-left');
            const barFill = document.getElementById('bar-fill');
            const v_id = localStorage.getItem('timer_v_id');

            overlay.style.display = 'block';

            if (timerInterval) clearInterval(timerInterval);

            timerInterval = setInterval(() => {
                const endTime = parseInt(localStorage.getItem('timer_end'));
                const now = Date.now();
                const diff = endTime - now;
                const timeLeft = Math.ceil(diff / 1000);

                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    overlay.style.display = 'none';
                    
                    // ‡¶ß‡¶æ‡¶™ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
                    let step = getCurrentStep(v_id);
                    step++;
                    localStorage.setItem('step_' + v_id, step);
                    
                    // ‡¶ï‡ßç‡¶≤‡¶ø‡¶®‡¶ø‡¶Ç
                    localStorage.removeItem('timer_running');
                    localStorage.removeItem('timer_end');
                    localStorage.removeItem('timer_v_id');
                    
                    renderUI();
                } else {
                    timeSpan.innerText = timeLeft;
                    barFill.style.width = ((10 - timeLeft) * 10) + '%';
                }
            }, 500);
        }
    </script>
</body>
</html>
