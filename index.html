<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VAIRAL VIDEO - Premium</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root { --main-grad: linear-gradient(135deg, #8e2de2, #4a00e0); --bg: #f8f9fa; }
        body { background: var(--bg); color: #333; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; }
        .header-section { background: var(--main-grad); padding: 40px 20px; text-align: center; color: white; border-radius: 0 0 35px 35px; }
        .header-section h1 { margin: 0; font-size: 26px; }
        .header-desc { font-size: 13px; margin-top: 10px; opacity: 0.9; }
        .main-content { padding: 15px; }
        .card { background: white; border-radius: 20px; overflow: hidden; margin-bottom: 25px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .thumb-box { width: 100%; height: 210px; }
        .thumb-box img { width: 100%; height: 100%; object-fit: cover; }
        .card-details { padding: 15px; text-align: center; }
        .unlock-btn { background: var(--main-grad); color: white; border: none; padding: 12px; width: 100%; border-radius: 12px; font-weight: bold; cursor: pointer; font-size: 16px; }
        .download-btn { background: #28a745 !important; }
        .ad-counter { display: block; margin-top: 8px; font-size: 14px; font-weight: bold; color: #666; }

        /* Telegram Style Full Ad View */
        #ad-view-container { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; z-index: 100000; flex-direction: column; }
        #ad-frame { width: 100%; height: calc(100% - 60px); border: none; }
        .ad-footer-timer { 
            height: 60px; background: rgba(255,255,255,0.95); 
            display: flex; justify-content: center; align-items: center; 
            border-top: 1px solid #ddd; position: absolute; bottom: 0; width: 100%;
            font-weight: bold; color: #4a00e0; font-size: 16px;
        }
        .close-ad-btn { 
            background: #4a00e0; color: white; border: none; 
            padding: 8px 20px; border-radius: 5px; display: none; cursor: pointer;
        }
    </style>
</head>
<body>

    <div class="header-section">
        <h1>All Video PLAY üîû</h1>
        <p class="header-desc">‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶∏‡¶¨ ‡¶ß‡¶æ‡¶™ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶π‡¶≤‡ßá ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶á‡¶®‡¶¨‡¶ï‡ßç‡¶∏‡ßá ‡¶™‡¶æ‡¶¨‡ßá‡¶®‡•§</p>
    </div>

    <div class="main-content" id="video-display">‡¶≤‡ßã‡¶°‡¶ø‡¶Ç...</div>

    <div id="ad-view-container">
        <iframe id="ad-frame" src=""></iframe>
        <div class="ad-footer-timer">
            <span id="timer-text">‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®: <span id="seconds">10</span> ‡¶∏‡ßá.</span>
            <button id="close-btn" class="close-ad-btn" onclick="closeAdView()">‡¶ß‡¶æ‡¶™ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® (‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®)</button>
        </div>
    </div>

    <script>
        const firebaseConfig = { databaseURL: "https://myvideobot-9f9ee-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let allVideos = {};
        let currentAds = [];
        let v_id = "";
        let completedSteps = 0;

        db.ref('videos').on('value', (snap) => {
            allVideos = snap.val();
            renderVideos(allVideos);
        });

        function renderVideos(data) {
            const container = document.getElementById('video-display');
            container.innerHTML = "";
            for (let id in data) {
                const total = data[id].ads ? data[id].ads.length : 0;
                container.innerHTML += `
                    <div class="card">
                        <div class="thumb-box"><img src="${data[id].photo}"></div>
                        <div class="card-details">
                            <h3>${data[id].name}</h3>
                            <button id="btn-${id}" class="unlock-btn" onclick='startAdFlow("${id}", ${JSON.stringify(data[id].ads)})'>üîí UNLOCK VIDEO</button>
                            <span id="counter-${id}" class="ad-counter">‡¶ß‡¶æ‡¶™ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®: 0/${total}</span>
                        </div>
                    </div>`;
            }
        }

        function startAdFlow(id, ads) {
            v_id = id; currentAds = ads;
            if (completedSteps >= currentAds.length) {
                window.location.href = "https://t.me/vairal_video18_bot?start=" + v_id;
                return;
            }
            openAdView();
        }

        function openAdView() {
            document.getElementById('ad-view-container').style.display = 'flex';
            document.getElementById('ad-frame').src = currentAds[completedSteps];
            document.getElementById('close-btn').style.display = 'none';
            document.getElementById('timer-text').style.display = 'block';
            
            let t = 10;
            const sec = document.getElementById('seconds');
            const itv = setInterval(() => {
                sec.innerText = t;
                if(t <= 0) {
                    clearInterval(itv);
                    document.getElementById('timer-text').style.display = 'none';
                    document.getElementById('close-btn').style.display = 'block';
                }
                t--;
            }, 1000);
        }

        function closeAdView() {
            completedSteps++;
            document.getElementById('ad-view-container').style.display = 'none';
            updateUI();
        }

        function updateUI() {
            const count = document.getElementById(`counter-${v_id}`);
            const btn = document.getElementById(`btn-${v_id}`);
            count.innerText = `‡¶ß‡¶æ‡¶™ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®: ${completedSteps}/${currentAds.length}`;
            if (completedSteps >= currentAds.length) {
                btn.innerText = "üì• GET VIDEO (DOWNLOAD)";
                btn.classList.add("download-btn");
                count.style.color = "#28a745";
                count.innerText = "‚úÖ ‡¶∏‡¶¨ ‡¶ß‡¶æ‡¶™ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®!";
            } else {
                btn.innerText = "üîì UNLOCK NEXT STEP";
            }
        }
    </script>
</body>
</html>
