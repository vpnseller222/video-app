<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VAIRAL VIDEO - Premium</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root { --main-grad: linear-gradient(135deg, #8e2de2, #4a00e0); --bg: #f8f9fa; }
        body { background: var(--bg); color: #333; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; }
        .header-section { background: var(--main-grad); padding: 30px 20px; text-align: center; color: white; border-radius: 0 0 35px 35px; }
        .search-container { padding: 0 20px; margin-top: -25px; }
        .search-box { 
            width: 100%; padding: 15px; border-radius: 15px; border: none; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.1); font-size: 16px; outline: none;
            box-sizing: border-box;
        }
        .main-content { padding: 15px; margin-top: 10px; }
        .card { background: white; border-radius: 20px; overflow: hidden; margin-bottom: 25px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .thumb-box { width: 100%; height: 210px; background: #ddd; }
        .thumb-box img { width: 100%; height: 100%; object-fit: cover; }
        .card-details { padding: 15px; text-align: center; }
        .unlock-btn { background: var(--main-grad); color: white; border: none; padding: 12px; width: 100%; border-radius: 12px; font-weight: bold; cursor: pointer; font-size: 16px; }
        .download-btn { background: #28a745 !important; }
        .ad-counter { display: block; margin-top: 8px; font-size: 14px; font-weight: bold; color: #666; }
        #loading-screen { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.98); z-index: 9999; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 20px; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid #4a00e0; border-radius: 50%; width: 45px; height: 45px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="loading-screen">
        <div class="spinner"></div>
        <p id="loading-text" style="margin-top:15px; font-weight:bold; color: #4a00e0;">‡¶ß‡¶æ‡¶™ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
    </div>

    <div class="header-section">
        <h1>All Video PLAY üîû</h1>
        <p>‡¶≠‡¶ø‡¶°‡¶ø‡¶ì‡¶ü‡¶ø ‡¶Ü‡¶®‡¶≤‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá ‡ß®‡ß™ ‡¶ò‡¶£‡ßç‡¶ü‡¶æ ‡¶´‡ßç‡¶∞‡¶ø ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§</p>
    </div>

    <div class="search-container">
        <input type="text" id="videoSearch" class="search-box" placeholder="‡¶≠‡¶ø‡¶°‡¶ø‡¶ì‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡ßü‡ßá ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶ï‡¶∞‡ßÅ‡¶®..." onkeyup="filterVideos()">
    </div>

    <div class="main-content" id="video-display">‡¶≤‡ßã‡¶°‡¶ø‡¶Ç...</div>

    <script>
        const firebaseConfig = { databaseURL: "https://myvideobot-9f9ee-default-rtdb.firebaseio.com/" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let allVideos = {};

        function getCurrentStep(v_id) {
            const expiry = localStorage.getItem('expiry_' + v_id);
            if (expiry && Date.now() > parseInt(expiry)) {
                localStorage.removeItem('step_' + v_id);
                localStorage.removeItem('expiry_' + v_id);
                return 0;
            }
            return parseInt(localStorage.getItem('step_' + v_id)) || 0;
        }

        db.ref('videos').on('value', (snap) => {
            allVideos = snap.val();
            renderUI();
        });

        function renderUI() {
            const container = document.getElementById('video-display');
            const searchInput = document.getElementById('videoSearch').value.toLowerCase();
            container.innerHTML = "";
            
            for (let id in allVideos) {
                if (!allVideos[id].name.toLowerCase().includes(searchInput)) continue;

                const ads = allVideos[id].ads || [];
                const step = getCurrentStep(id);
                const total = ads.length;
                let btnTxt = step >= total ? "üì• GET VIDEO (DOWNLOAD)" : (step > 0 ? "üîì UNLOCK NEXT AD" : "üîí UNLOCK VIDEO");
                let btnClass = step >= total ? "unlock-btn download-btn" : "unlock-btn";
                
                container.innerHTML += `
                    <div class="card video-card">
                        <div class="thumb-box"><img src="${allVideos[id].photo}"></div>
                        <div class="card-details">
                            <h3>${allVideos[id].name}</h3>
                            <button class="${btnClass}" onclick='handleAdClick("${id}", ${JSON.stringify(ads)})'>${btnTxt}</button>
                            <span class="ad-counter">${step >= total ? '‚úÖ ‡ß®‡ß™ ‡¶ò‡¶£‡ßç‡¶ü‡¶æ ‡¶Ü‡¶®‡¶≤‡¶ï ‡¶•‡¶æ‡¶ï‡¶¨‡ßá' : '‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®: ' + step + '/' + total}</span>
                        </div>
                    </div>`;
            }
        }

        function filterVideos() { renderUI(); }

        function handleAdClick(v_id, ads) {
            let step = getCurrentStep(v_id);
            if (step >= ads.length) {
                localStorage.setItem('expiry_' + v_id, Date.now() + (24 * 60 * 60 * 1000));
                window.location.href = "https://t.me/vairal_video18_bot?start=" + v_id;
                return;
            }
            localStorage.setItem('waiting_v_id', v_id);
            localStorage.setItem('click_time', Date.now());
            window.open(ads[step], '_blank');
        }

        // ‡¶∂‡¶ï‡ßç‡¶§‡¶ø‡¶∂‡¶æ‡¶≤‡ßÄ ‡¶ö‡ßá‡¶ï ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶Ø‡¶æ ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ü‡¶∏‡¶æ ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞‡¶á ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶¨‡ßá
        function checkProgress() {
            const v_id = localStorage.getItem('waiting_v_id');
            const clickTime = localStorage.getItem('click_time');

            if (v_id && clickTime) {
                const timeDiff = Date.now() - parseInt(clickTime);
                localStorage.removeItem('waiting_v_id');
                localStorage.removeItem('click_time');

                document.getElementById('loading-screen').style.display = 'flex';
                
                // ‡¶∂‡¶∞‡ßç‡¶§: ‡ßß‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá
                if (timeDiff >= 10000) {
                    document.getElementById('loading-text').innerText = "‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®!";
                    setTimeout(() => {
                        let step = getCurrentStep(v_id);
                        step++;
                        localStorage.setItem('step_' + v_id, step);
                        document.getElementById('loading-screen').style.display = 'none';
                        renderUI();
                    }, 2000);
                } else {
                    document.getElementById('loading-text').innerHTML = "<span style='color:red;'>‡¶≠‡ßÅ‡¶≤!</span> ‡¶Ü‡¶™‡¶®‡¶ø ‡ßß‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßá‡¶®‡¶®‡¶ø‡•§";
                    setTimeout(() => {
                        document.getElementById('loading-screen').style.display = 'none';
                    }, 3000);
                }
            }
        }

        // ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞‡ßá ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ü‡¶∏‡¶æ ‡¶∂‡¶®‡¶æ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡¶æ (Focus & Visibility)
        window.addEventListener('focus', checkProgress);
        document.addEventListener('visibilitychange', () => {
            if (document.visibilityState === 'visible') checkProgress();
        });

    </script>
</body>
</html>
